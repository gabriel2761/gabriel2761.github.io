var app=app||{};app.Database=function(){this.KEY="awef83hriwalgbwaeg8ahwpfoiengp9seugbzspi3uhfsozigbps9zugbspigbp3PFQFNZKLNVZSKEFBSLEIGUBSPG9UQB";var e=JSON.parse(localStorage.getItem(this.KEY));null===e&&localStorage.setItem(this.KEY,JSON.stringify([])),this.ID_COUNT="sldzijfo9s3gfzsos876bOBkuyfcKUtyfytrdJu643557FfjUTfkuyg9uhcnussbskxudgzzopowoskskxdjmgcxjk";var t=localStorage.getItem(this.ID_COUNT);null===t&&localStorage.setItem(this.ID_COUNT,0)},app.Database.prototype.getId=function(){var e=parseInt(localStorage.getItem(this.ID_COUNT));return localStorage.setItem(this.ID_COUNT,++e),e},app.Database.prototype.getFoods=function(){return JSON.parse(localStorage.getItem(this.KEY))},app.Database.prototype.addFood=function(e){var t=new Date,a=t.getDate(),o=t.getMonth()+1,i=t.getFullYear(),n=a+"-"+o+"-"+i,s=this.getFoods(),l=this.getId();s.push({databaseId:l,date:n,name:e.get("name"),calories:e.get("calories"),brandname:e.get("brandname")}),localStorage.setItem(this.KEY,JSON.stringify(s))},app.Database.prototype.removeFood=function(e){var t=this.getFoods();t.forEach(function(a){a.databaseId===e.get("databaseId")&&t.splice(t.indexOf(a),1)}),localStorage.setItem(this.KEY,JSON.stringify(t))};var app=app||{};app.FoodModel=Backbone.Model.extend({defaults:{databaseId:-1,name:"",calories:0,brandname:"",date:""},add:function(){var e=new app.Database;e.addFood(this)},remove:function(){var e=new app.Database;e.removeFood(this)}}),app.ProfileModel=Backbone.Model.extend({defaults:{totalCalories:0},initialize:function(){this.update()},update:function(){var e=0,t=new app.Database;t.getFoods().forEach(function(t){e+=t.calories}),this.set("totalCalories",e)}});var app=app||{};app.FoodCollection=Backbone.Collection.extend({model:app.FoodModel,initialize:function(){self=this},search:function(e,t){self=this;var a="https://api.nutritionix.com/v1_1/search/"+e+"?fields=item_name%2Citem_id%2Cbrand_name%2Cnf_calories%2Cnf_total_fat&appId=283e6104&appKey=7adbf74351829801e39b98eb74723505";$.ajax({url:a,dataType:"json"}).done(function(e){var a=e.hits;a.forEach(function(e){self.add(new app.FoodModel({name:e.fields.item_name,brandname:e.fields.brand_name,calories:Math.round(e.fields.nf_calories)}))}),t(!0)}).error(function(e,a,o){t(!1)})}});var app=app||{};app.NavigationView=Backbone.View.extend({tagName:"nav",className:"navigation",template:_.template($("#navigation-template").html()),events:{"click #navigation-foods-tab":"showFoods","click #navigation-profile-tab":"showProfile"},render:function(){return this.$el.html(this.template),this},showFoods:function(){$("#foods").hasClass("hidden")&&($("#foods").removeClass("hidden"),$("#profile").addClass("hidden")),$("#navigation-profile-tab").hasClass("underline-red")&&($("#navigation-profile-tab").removeClass("underline-red"),$("#navigation-foods-tab").addClass("underline-red"))},showProfile:function(){$("#profile").hasClass("hidden")&&($("#profile").removeClass("hidden"),$("#foods").addClass("hidden")),$("#navigation-foods-tab").hasClass("underline-red")&&($("#navigation-foods-tab").removeClass("underline-red"),$("#navigation-profile-tab").addClass("underline-red"))}}),app.ProfileView=Backbone.View.extend({tagName:"section",className:"profile-view",template:_.template($("#profile-template").html()),initialize:function(){this.model.on("change",this.update,this)},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this},update:function(){var e=this,t=null;$("#total-calories").text(this.model.get("totalCalories")),$("#profile-foods").empty(),this.database=new app.Database;var a=this.database.getFoods();a.forEach(function(o){var i=new app.FoodModel({databaseId:o.databaseId,date:o.date,name:o.name,calories:o.calories,brandname:o.brandname}),n=new app.FoodItemView({model:i,className:"food-item profile-item",profile:e.model});if(s+=o.calories,t!==o.date||null===t){var s=0;t=o.date,a.forEach(function(e){t===e.date&&(s+=e.calories)}),$("#profile-foods").prepend('<div id="date-heading" class="date-heading"><h3>'+t+"</h3><p>total "+s+"</p></div>")}t=o.date,n.delegateEvents({"click #trash":"remove"}),$(n.render().el).insertAfter("#date-heading")})}}),app.FoodItemView=Backbone.View.extend({tagName:"section",className:"food-item",template:_.template($("#food-item-template").html()),events:{click:"addFood"},initialize:function(e){this.profile=e.profile,this.notification=e.notification},addFood:function(){$("#food-search-results").empty(),this.model.add(),this.profile.update(),this.notification.showMessage("Added "+this.model.get("brandname"))},render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this},remove:function(){this.model.remove(),this.profile.update()}}),app.FoodCollectionView=Backbone.View.extend({template:_.template($("#food-collection-template").html()),events:{"click #search-button":"search","keyup #search-bar":"checkEnterPressed"},initialize:function(e){this.profile=e.profile,this.notification=e.notification,this.collection.on("add",this.addFood,this)},render:function(){return this.$el.html(this.template),this},search:function(){var e=this;$("#food-search-results").empty(),$("#loading-icon").removeClass("hidden");var t=$("#search-bar").val();e.collection.reset(),e.collection.search(t,function(t){t?e.collection.each(e.addFood,e):e.notification.showMessage("Something went wrong"),$("#loading-icon").addClass("hidden")})},addFood:function(e){var t=new app.FoodItemView({model:e,profile:this.profile,notification:this.notification});$("#food-search-results").append(t.render().el)},checkEnterPressed:function(e){13===e.keyCode&&this.search()}}),app.NotificationView=Backbone.View.extend({id:"notification",tagName:"section",className:"notification",template:_.template($("#notification-template").html()),render:function(){this.template(this.model);return this.$el.html(this.template),this},showMessage:function(e){$("#notification").addClass("show"),$("#notification-brandname").html(e),setTimeout(function(){$("#notification").removeClass("show")},1e3)}});var app=app||{},notificationView=new app.NotificationView({}),foodCollection=new app.FoodCollection([]),profileModel=new app.ProfileModel({}),navigationView=new app.NavigationView({}),foodCollectionView=new app.FoodCollectionView({collection:foodCollection,profile:profileModel,notification:notificationView}),profileView=new app.ProfileView({model:profileModel});$("#main-container").prepend(navigationView.render().el),$("#foods").html(foodCollectionView.render().el),$("#profile").html(profileView.render().el),$("main").append(notificationView.render().el),profileView.update();